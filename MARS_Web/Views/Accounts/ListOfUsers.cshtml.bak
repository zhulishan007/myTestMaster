@*@model IEnumerable<Mars_Data.Models.T_TESTER_INFO>*@
@*@model IEnumerable<Mars_Data.Models.T_MARS_COMPANY>*@
@*@model IEnumerable<MARS_Repository.ViewModel.UserModel>*@

@{
    /**/

    ViewBag.Title = "ListOfUsers";


    if (Session["SubmitUserMsg"] != null)
    {
        var lMsg = Session["SubmitUserMsg"] as string;
        if (!string.IsNullOrEmpty(lMsg))
        {
            <script>
                setTimeout(function () {
                    swal.fire({
                        "title": "",
                        "text": "@lMsg",
                        "type": "success",
                        "onClose": function (e) {
                            console.log('on close event fired!');
                        }
                    });
                }, 1000);
                
            </script>
            Session["SubmitUserMsg"] = "";
        }
    }

}




<p>
    @*@Html.ActionLink("Create New", "Create")*@
</p>
<div class="kt-content  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">
    <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">
        <div class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__head kt-portlet__head--lg">
                <div class="kt-portlet__head-label">
                    <h3 class="kt-portlet__head-title" style="color:#1582ab">
                        List Of All Users
                    </h3>
                </div>
                <div class="kt-portlet__head-toolbar">
                    <div class="kt-portlet__head-wrapper">
                        <div class="kt-portlet__head-actions">
                            <div class="dropdown dropdown-inline">
                                <button type="button" class="btn btn-default btn-icon-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="la la-download"></i> Export
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <ul class="kt-nav">
                                        <li class="kt-nav__section kt-nav__section--first">
                                            <span class="kt-nav__section-text">Choose an option</span>
                                        </li>
                                        <li class="kt-nav__item">
                                            <a href="#" class="kt-nav__link">
                                                <i class="kt-nav__link-icon la la-print"></i>
                                                <span class="kt-nav__link-text">Print</span>
                                            </a>
                                        </li>
                                        <li class="kt-nav__item">
                                            <a href="#" class="kt-nav__link">
                                                <i class="kt-nav__link-icon la la-copy"></i>
                                                <span class="kt-nav__link-text">Copy</span>
                                            </a>
                                        </li>
                                        <li class="kt-nav__item">
                                            <a href="#" class="kt-nav__link">
                                                <i class="kt-nav__link-icon la la-file-excel-o"></i>
                                                <span class="kt-nav__link-text">Excel</span>
                                            </a>
                                        </li>
                                        <li class="kt-nav__item">
                                            <a href="#" class="kt-nav__link">
                                                <i class="kt-nav__link-icon la la-file-text-o"></i>
                                                <span class="kt-nav__link-text">CSV</span>
                                            </a>
                                        </li>
                                        <li class="kt-nav__item">
                                            <a href="#" class="kt-nav__link">
                                                <i class="kt-nav__link-icon la la-file-pdf-o"></i>
                                                <span class="kt-nav__link-text">PDF</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            &nbsp;
                            <a href="/Accounts/AddEditUser" class="btn btn-brand btn-elevate btn-icon-sm">
                                <i class="la la-plus"></i>
                                New Record
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="kt-portlet__body">
                <table class="table table-striped- table-bordered table-hover table-checkable " id="kt_table">
                    <thead>
                        <tr>
                            <th>Last Name</th>
                            <th>Middle Name</th>
                            <th>First Name</th>
                            <th>User Name</th>
                            <th>Email Address</th>
                            <th>Company Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>


                </table>
            </div>
        </div>
    </div>
</div>


@section footerJquery
{
    <script>
        var KTDatatablesSearchOptionsColumnSearch = function () {

            $.fn.dataTable.Api.register('column().title()', function () {
                return $(this.header()).text().trim();
            });

            var initTable1 = function () {

                // begin first table
                var table = $('#kt_table').DataTable({
                    responsive: true,

                    // Pagination settings
                    dom: `<'row'<'col-sm-12'tr>>
                        <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 dataTables_pager'lp>>`,
                    // read more: https://datatables.net/examples/basic_init/dom.html

                    lengthMenu: [10,100,1000],
                    processing: true,
                    pageLength: 10,

                    language: {
                        'lengthMenu': 'Display _MENU_',
                    },

                    searchDelay: 500,
                    //  processing: true,
                    serverSide: true,
                    ajax: {
                        url: '/Accounts/DataLoad',
                        type: 'POST',
                        data: {
                            // parameters for custom backend script demo
                            columnsDef: [
                                'TESTER_NAME_LAST', 'TESTER_NAME_M', 'TESTER_NAME_F', 'TESTER_LOGIN_NAME', 'TESTER_MAIL',
                                'COMPANY_NAME', 'Actions',],
                        },
                    },

                    columns: [
                        { data: 'TESTER_NAME_LAST', name:"Last Name" },
                        { data: 'TESTER_NAME_M', name: "Middle Name"},
                        { data: 'TESTER_NAME_F', name: "First Name"},
                        { data: 'TESTER_LOGIN_NAME', name: "User Name"},
                        { data: 'TESTER_MAIL', name: "Email Address"},
                        { data: 'COMPANY_NAME', name: "Company Name"},
                        { data: 'Actions', responsivePriority: -1 }
                    ],
                    initComplete: function () {
                        var thisTable = this;
                        var rowFilter = $('<tr class="filter"></tr>').appendTo($(table.table().header()));

                        table.columns().every(function () {
                            var column = this;
                            var input;

                            switch (column.title()) {
                                case 'Last Name':
                                case 'Middle Name':
                                case 'First Name':
                                case 'User Name':
                                case 'Email Address':
                                case 'Company Name':
                                    input = $(`<input type="text" class="form-control form-control-sm form-filter kt-input" data-col-index="` + column.index() + `"/>`);
                                    break;


                                case 'Actions':
                                    var search = $(`<button class="btn btn-brand kt-btn btn-sm kt-btn--icon">
                                          <span>
                                            <i class="la la-search"></i>
                                            <span>search</span>
                                          </span>
                                        </button>`);

                                    var reset = $(`<button class="btn btn-secondary kt-btn btn-sm kt-btn--icon">
                                          <span>
                                            <i class="la la-close"></i>
                                            <span>reset</span>
                                          </span>
                                        </button>`);

                                    $('<th>').append(search).append(reset).appendTo(rowFilter);

                                    $(search).on('click', function (e) {

                                        var params = {};
                                        $(rowFilter).find('.kt-input').each(function () {
                                            var i = $(this).data('col-index');
                                            if (params[i]) {
                                                params[i] += '|' + $(this).val();
                                            }
                                            else {
                                                params[i] = $(this).val();
                                            }
                                        });
                                        $.each(params, function (i, val) {
                                            // apply search params to datatable
                                            table.column(i).search(val ? val : '', false, false);
                                        });
                                        table.table().draw();
                                    });

                                    $(reset).on('click', function (e) {
                                        $(rowFilter).find('.kt-input').each(function (i) {
                                            $(this).val('');
                                            table.column($(this).data('col-index')).search('', false, false);
                                        });
                                        table.table().draw();
                                    });
                                    break;
                            }

                            if (column.title() !== 'actions') {
                                $(input).appendTo($('<th>').appendTo(rowFilter));
                            }
                        });

                        // hide search column for responsive table
                        var hideSearchColumnResponsive = function () {
                            thisTable.api().columns().every(function () {
                                var column = this
                                if (column.responsiveHidden()) {
                                    $(rowFilter).find('th').eq(column.index()).show();
                                } else {
                                    $(rowFilter).find('th').eq(column.index()).hide();
                                }
                            })
                        };

                        // init on datatable load
                        hideSearchColumnResponsive();
                        // recheck on window resize
                        window.onresize = hideSearchColumnResponsive;
                    },
                    columnDefs: [
                        {
                            targets: -1,
                            title: 'Actions',
                            orderable: false,
                            render: function (data, type, full, meta) {
                                var lid = full.TESTER_ID;
                                return " <a href='/Accounts/AddEditUser?lid=" + lid + "' class='btn btn-sm btn-clean btn-icon btn-icon-md' title='View'><i class='la la-edit'></i></a>";
                               
                            },
                        },
                    ],
                });

            };

            return {

                //main function to initiate the module
                init: function () {
                    initTable1();
                },

            };

        }();

        jQuery(document).ready(function () {
            KTDatatablesSearchOptionsColumnSearch.init();
        });



    </script>
}


