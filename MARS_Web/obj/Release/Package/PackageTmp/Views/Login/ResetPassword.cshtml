@model MARS_Repository.Entities.T_TESTER_INFO
@{
    Layout = null;
}

<!DOCTYPE html>
<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 4 & Angular 8
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
Renew Support: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<html lang="en">
<!-- begin::Head -->
<head>
    <base href="../../../">
    <meta charset="utf-8" />
    @*<title>Metronic | Login Page v3</title>*@
    <title>@ViewBag.MarsTitle</title>
    
    <meta name="description" content="Login page example">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--begin::Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700|Roboto:300,400,500,600,700">
    <!--end::Fonts -->
    <!--begin::Page Custom Styles(used by this page) -->
    <link href="~/assets/css/pages/login/login-3.css" rel="stylesheet" type="text/css" />
    <!--end::Page Custom Styles -->
    <!--begin::Global Theme Styles(used by all pages) -->
    <link href="~/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <!--end::Global Theme Styles -->
    <!--begin::Layout Skins(used by all pages) -->
    <link href="~/assets/css/skins/header/base/light.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/skins/header/menu/light.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/skins/brand/dark.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/skins/aside/dark.css" rel="stylesheet" type="text/css" />
    <!--end::Layout Skins -->
    @*<link rel="shortcut icon" href="~/assets/media/logos/favicon.ico" />*@
    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
</head>
<!-- end::Head -->
<!-- begin::Body -->
<body class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--enabled kt-subheader--fixed kt-subheader--solid kt-aside--enabled kt-aside--fixed kt-page--loading">
    <!-- begin:: Page -->
    <div style="background-image: url(assets/media/login/login-4-bg.jpg);background-repeat: no-repeat; background-size: cover; background-position: bottom;" class="kt-grid kt-grid--ver kt-grid--root">
        <div class="kt-grid kt-grid--hor kt-grid--root  kt-login kt-login--v3 kt-login--signin">
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
                <div class="kt-grid__item kt-grid__item--fluid kt-login__wrapper">
                    <div class="kt-login__container">
                        <div class="kt-login__logo">
                            <a href="#">
                                @*<img src="~/assets/media/logos/logo-5.png">*@
                                <img src="~/assets/media/Logo/MARS_LOGO.png" style="height:88px" />
                            </a>
                        </div>
                        <div class="kt-login__signin">
                            <div class="kt-login__head">
                                <h3 class="kt-login__title">Reset Your Password</h3>
                            </div>
                            <form class="kt-form" action="" id="login_form">

                                <div class="input-group">
                                    @Html.PasswordFor(m => m.TESTER_PWD, new { @class = "form-control", @id = "Password", @name = "Password", placeholder = "Password", @required = "required" })
                                </div>
                                <div class="input-group">
                                    <input class="form-control" type="password" placeholder="Confirm Password" name="cpassword" id="cpassword">
                                </div>
                                @*<div class="input-group">
                                        @Html.HiddenFor(m => m.TEMP_KEY, new { @class = "form-control", @id = "tempkey" })
                                    </div>*@
                                <div class="input-group">
                                    @Html.HiddenFor(m => m.TESTER_MAIL, new { @class = "form-control", @id = "Email" })
                                </div>
                                <div class="kt-login__actions">
                                    <button type="button" id="btnreset" class="btn btn-brand btn-elevate kt-login__btn-primary">Reset</button>
                                </div>
                            </form>
                        </div>
                        <div class="kt-login__signup">


                        </div>



                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end:: Page -->
    <!-- begin::Global Config(global config for global JS sciprts) -->

    <script type="text/javascript">
        $(document).ready(function () {
            $("#login_form").validate({
                rules: {

                    TESTER_PWD: {
                        required: true,
                        minlength: 5,
                        pwcheck: true,
                    },

                    cpassword: {
                        equalTo: "#Password",
                    }

                },
                messages: {
                    TESTER_PWD: {
                        pwcheck: "Please enter atleast one digit, one UpperCase letter, one LowerCase letter and one special character",
                    },
                },
                invalidHandler: function (event, validator) {
                    swal.fire({
                        "title": "",
                        "text": "There are some invalid entries. Please correct and submit again.",
                        "icon": "error",
                        "confirmButtonClass": "btn btn-secondary",
                        "onClose": function (e) {
                            console.log('on close event fired!');
                        }
                    });

                    event.preventDefault();
                },
            });

            $.validator.addMethod("pwcheck", function (value) {
                return /^[A-Za-z0-9\d=!\-@@._*]*$/.test(value) // consists of only these
                    && /[a-z]/.test(value) // has a lowercase letter
                    && /\d/.test(value) // has a digit
            });

        });
        $("#btnreset").click(function () {

            if ($("#login_form").valid()) {
                var vars = [], hash;
                var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < hashes.length; i++) {
                    hash = hashes[i].split('=');
                    vars.push(hash[0]);
                    vars[hash[0]] = hash[1];
                }
                TESTER_PWD = $("#Password").val(),
                    $.ajax({
                        url: "/Login/ResetPwd",
                        data: '{"emailid":"' + vars.UserEmail + '","TESTER_PWD":"' + TESTER_PWD + '","TempKey:":"' + vars.TempKey + '"}',
                        type: "POST",
                        contentType: "application/json;charset=utf-8",
                        dataType: "json",
                        success: function (result) {
                            if (result.status == 1) {
                                window.location.href = "/Login/Login";
                            }
                            else if (result.status == 0) {
                                swal.fire({
                                    "title": "",
                                    "text": result.message,
                                    "icon": "error",
                                    "onClose": function (e) {
                                        console.log('on close event fired!');
                                    }
                                });
                            }
                        },
                        error: function (errormessage) {
                            alert(errormessage.responseText);
                        }
                    });



            }

        });
    </script>
    <!-- end::Global Config -->
    <!--begin::Global Theme Bundle(used by all pages) -->
    <script src="~/assets/plugins/global/plugins.bundle.js" type="text/javascript"></script>
    <script src="~/assets/js/scripts.bundle.js" type="text/javascript"></script>
    <!--end::Global Theme Bundle -->
    <!--begin::Page Scripts(used by this page) -->
    <script src="~/assets/js/pages/custom/login/login-general.js" type="text/javascript"></script>
    <!--end::Page Scripts -->
</body>
<!-- end::Body -->
</html>
